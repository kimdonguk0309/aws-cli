aws ec2 create-vpc --cidr-block 10.0.0.0/16 --tag-specifications ResourceTypr=vpc,Tags=[{Key=Name,Value=MyVpc}]

aws ec2 create-subnet --vpc-id vpc-xxx --cidr-block 10.0.0.0/24 --tag-specifications ResourceTypr=subnet,Tags=[{Key=Name,Value=MySubent}]

###############################
#!/bin/bash

# VPC ìƒì„±
echo "Creating VPC..."
VPC_ID=$(aws ec2 create-vpc \
  --cidr-block 10.0.0.0/16 \
  --tag-specifications 'ResourceType=vpc,Tags=[{Key=Name,Value=MyVpc}]' \
  --query 'Vpc.VpcId' \
  --output text)

echo "VPC created with ID: $VPC_ID"

# Subnet ìƒì„±
echo "Creating Subnet..."
SUBNET_ID=$(aws ec2 create-subnet \
  --vpc-id "$VPC_ID" \
  --cidr-block 10.0.0.0/24 \
  --tag-specifications 'ResourceType=subnet,Tags=[{Key=Name,Value=MySubnet}]' \
  --query 'Subnet.SubnetId' \
  --output text)

echo "Subnet created with ID: $SUBNET_ID"
##############################



#!/bin/bash
# Usage: ./setup_vpc_ec2.sh <VPC_CIDR> <PUB_SUBNET_CIDR> <PRIV_SUBNET_CIDR> <KEY_NAME> <AMI_ID> <INSTANCE_TYPE>

VPC_CIDR="$1"
PUB_CIDR="$2"
PRIV_CIDR="$3"
KEY_NAME="$4"
AMI_ID="$5"
INSTANCE_TYPE="$6"

if [[ $# -ne 6 ]]; then
  echo "Usage: $0 <VPC_CIDR> <PUB_SUBNET_CIDR> <PRIV_SUBNET_CIDR> <KEY_NAME> <AMI_ID> <INSTANCE_TYPE>"
  exit 1
fi

# 1ï¸âƒ£ VPC ìƒì„±
VPC_ID=$(aws ec2 create-vpc \
  --cidr-block "$VPC_CIDR" \
  --query 'Vpc.VpcId' \
  --output text)
aws ec2 modify-vpc-attribute --vpc-id "$VPC_ID" --enable-dns-hostnames "{\"Value\":true}"
aws ec2 modify-vpc-attribute --vpc-id "$VPC_ID" --enable-dns-support "{\"Value\":true}"
echo "âœ”ï¸ VPC created: $VPC_ID"

# 2ï¸âƒ£ ì„œë¸Œë„· ìƒì„± (ê³µìš© ë° ì‚¬ì„¤)
PUB_SUBNET=$(aws ec2 create-subnet \
  --vpc-id "$VPC_ID" \
  --cidr-block "$PUB_CIDR" \
  --query 'Subnet.SubnetId' --output text)
aws ec2 modify-subnet-attribute --subnet-id "$PUB_SUBNET" --map-public-ip-on-launch
PRIV_SUBNET=$(aws ec2 create-subnet \
  --vpc-id "$VPC_ID" \
  --cidr-block "$PRIV_CIDR" \
  --query 'Subnet.SubnetId' --output text)
echo "âœ”ï¸ Subnets created: Public=$PUB_SUBNET, Private=$PRIV_SUBNET"

# 3ï¸âƒ£ Internet Gateway ìƒì„± ë° Attach
IGW=$(aws ec2 create-internet-gateway --query 'InternetGateway.InternetGatewayId' --output text)
aws ec2 attach-internet-gateway --vpc-id "$VPC_ID" --internet-gateway-id "$IGW"
echo "âœ”ï¸ IGW created and attached: $IGW"

# 4ï¸âƒ£ Route Table ìƒì„± ë° IGWì— ë¼ìš°íŒ… ì¶”ê°€
RTB=$(aws ec2 create-route-table --vpc-id "$VPC_ID" --query 'RouteTable.RouteTableId' --output text)
aws ec2 create-route --route-table-id "$RTB" --destination-cidr-block 0.0.0.0/0 --gateway-id "$IGW"
aws ec2 associate-route-table --subnet-id "$PUB_SUBNET" --route-table-id "$RTB"
echo "âœ”ï¸ RouteTable created and associated to public subnet"

# 5ï¸âƒ£ Security Group ìƒì„±
SG=$(aws ec2 create-security-group \
  --group-name "${VPC_ID}-sg" \
  --description "VPC-wide SG" \
  --vpc-id "$VPC_ID" \
  --query 'GroupId' --output text)
aws ec2 authorize-security-group-ingress \
  --group-id "$SG" \
  --protocol tcp \
  --port 22 0.0.0.0/0
echo "âœ”ï¸ Security Group created: $SG"

# 6ï¸âƒ£ EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (ê³µìš© ì„œë¸Œë„·ì— ë°°í¬)
INSTANCE_ID=$(aws ec2 run-instances \
  --image-id "$AMI_ID" \
  --instance-type "$INSTANCE_TYPE" \
  --key-name "$KEY_NAME" \
  --security-group-ids "$SG" \
  --subnet-id "$PUB_SUBNET" \
  --query 'Instances[0].InstanceId' \
  --output text)
echo "âœ”ï¸ EC2 Instance launched: $INSTANCE_ID"

# 7ï¸âƒ£ Elastic IP ìƒì„± ë° ì—°ê²°
ALLOCATION_ID=$(aws ec2 allocate-address --domain vpc --query 'AllocationId' --output text)
aws ec2 associate-address --instance-id "$INSTANCE_ID" --allocation-id "$ALLOCATION_ID"
echo "âœ”ï¸ EIP allocated and associated"

# 8ï¸âƒ£ ì¸ìŠ¤í„´ìŠ¤ ìƒíƒœ í™•ì¸ ë° íƒœê·¸ ì§€ì •
aws ec2 wait instance-running --instance-ids "$INSTANCE_ID"
aws ec2 create-tags --resources "$VPC_ID" "$PUB_SUBNET" "$PRIV_SUBNET" "$IGW" "$RTB" "$SG" "$INSTANCE_ID" \
  --tags Key=Name,Value=MyVPC Key=Env,Value=Dev
echo "ğŸ·ï¸ All resources tagged"

# 9ï¸âƒ£ ì ‘ì† ì •ë³´ 
PUB_IP=$(aws ec2 describe-instances \
  --instance-ids "$INSTANCE_ID" \
  --query 'Reservations[0].Instances[0].PublicIpAddress' \
  --output text)
echo "ğŸ” SSH: ssh -i ${KEY_NAME}.pem ec2-user@${PUB_IP}"

